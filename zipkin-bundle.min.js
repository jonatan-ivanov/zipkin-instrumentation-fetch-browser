!function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[a]={exports:{}};e[a][0].call(h.exports,(function(t){return o(e[a][1][t]||t)}),h,h.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){(function(t,n){(function(){e.exports=t.hrtime||function(t){var e=.001*o.call(r),n=Math.floor(e),i=Math.floor(e%1*1e9);t&&(n-=t[0],(i-=t[1])<0&&(n--,i+=1e9));return[n,i]};var r=n.performance||{},o=r.now||r.mozNow||r.msNow||r.oNow||r.webkitNow||function(){return(new Date).getTime()}}).call(this)}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:5}],2:[function(t,e,n){"use strict";var r,o="object"==typeof Reflect?Reflect:null,i=o&&"function"==typeof o.apply?o.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=o&&"function"==typeof o.ownKeys?o.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(t,e){return new Promise((function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}y(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&y(t,"error",e,n)}(t,o,{once:!0})}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function p(t,e,n,r){var o,i,a,s;if(u(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),a=i[e]),void 0===a)a=i[e]=n,++t._eventsCount;else if("function"==typeof a?a=i[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=h(t))>0&&a.length>o&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return t}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=l.bind(r);return o.listener=n,r.wrapFn=o,o}function d(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):m(o,o.length)}function v(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function y(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function o(i){r.once&&t.removeEventListener(e,o),n(i)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return h(this)},s.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=o[t];if(void 0===c)return!1;if("function"==typeof c)i(c,this,e);else{var u=c.length,h=m(c,u);for(n=0;n<u;++n)i(h[n],this,e)}return!0},s.prototype.addListener=function(t,e){return p(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return p(this,t,e,!0)},s.prototype.once=function(t,e){return u(e),this.on(t,f(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,f(this,t,e)),this},s.prototype.removeListener=function(t,e){var n,r,o,i,a;if(u(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},s.prototype.listeners=function(t){return d(this,t,!0)},s.prototype.rawListeners=function(t){return d(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):v.call(t,e)},s.prototype.listenerCount=v,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},{}],3:[function(t,e,n){(function(t){(function(){"use strict";var t=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();e.exports=n=t.fetch,t.fetch&&(n.default=t.fetch.bind(t)),n.Headers=t.Headers,n.Request=t.Request,n.Response=t.Response}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(t,e,n){n.endianness=function(){return"LE"},n.hostname=function(){return"undefined"!=typeof location?location.hostname:""},n.loadavg=function(){return[]},n.uptime=function(){return 0},n.freemem=function(){return Number.MAX_VALUE},n.totalmem=function(){return Number.MAX_VALUE},n.cpus=function(){return[]},n.type=function(){return"Browser"},n.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},n.networkInterfaces=n.getNetworkInterfaces=function(){return{}},n.arch=function(){return"javascript"},n.platform=function(){return"browser"},n.tmpdir=n.tmpDir=function(){return"/tmp"},n.EOL="\n",n.homedir=function(){return"/"}},{}],5:[function(t,e,n){var r,o,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(t){o=s}}();var u,h=[],p=!1,l=-1;function f(){p&&u&&(p=!1,u.length?h=u.concat(h):l=-1,h.length&&d())}function d(){if(!p){var t=c(f);p=!0;for(var e=h.length;e;){for(u=h,h=[];++l<e;)u&&u[l].run();l=-1,e=h.length}u=null,p=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(t)}}function v(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new v(t,e)),1!==h.length||p||c(d)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],6:[function(t,e,n){(function(t){(function(){!function(r){var o="object"==typeof n&&n&&!n.nodeType&&n,i="object"==typeof e&&e&&!e.nodeType&&e,a="object"==typeof t&&t;a.global!==a&&a.window!==a&&a.self!==a||(r=a);var s,c,u=2147483647,h=36,p=/^xn--/,l=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=Math.floor,m=String.fromCharCode;function y(t){throw new RangeError(d[t])}function g(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function w(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+g((t=t.replace(f,".")).split("."),e).join(".")}function S(t){for(var e,n,r=[],o=0,i=t.length;o<i;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<i?56320==(64512&(n=t.charCodeAt(o++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),o--):r.push(e);return r}function b(t){return g(t,(function(t){var e="";return t>65535&&(e+=m((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=m(t)})).join("")}function I(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function E(t,e,n){var r=0;for(t=n?v(t/700):t>>1,t+=v(t/e);t>455;r+=h)t=v(t/35);return v(r+36*t/(t+38))}function k(t){var e,n,r,o,i,a,s,c,p,l,f,d=[],m=t.length,g=0,w=128,S=72;for((n=t.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&y("not-basic"),d.push(t.charCodeAt(r));for(o=n>0?n+1:0;o<m;){for(i=g,a=1,s=h;o>=m&&y("invalid-input"),((c=(f=t.charCodeAt(o++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:h)>=h||c>v((u-g)/a))&&y("overflow"),g+=c*a,!(c<(p=s<=S?1:s>=S+26?26:s-S));s+=h)a>v(u/(l=h-p))&&y("overflow"),a*=l;S=E(g-i,e=d.length+1,0==i),v(g/e)>u-w&&y("overflow"),w+=v(g/e),g%=e,d.splice(g++,0,w)}return b(d)}function O(t){var e,n,r,o,i,a,s,c,p,l,f,d,g,w,b,k=[];for(d=(t=S(t)).length,e=128,n=0,i=72,a=0;a<d;++a)(f=t[a])<128&&k.push(m(f));for(r=o=k.length,o&&k.push("-");r<d;){for(s=u,a=0;a<d;++a)(f=t[a])>=e&&f<s&&(s=f);for(s-e>v((u-n)/(g=r+1))&&y("overflow"),n+=(s-e)*g,e=s,a=0;a<d;++a)if((f=t[a])<e&&++n>u&&y("overflow"),f==e){for(c=n,p=h;!(c<(l=p<=i?1:p>=i+26?26:p-i));p+=h)b=c-l,w=h-l,k.push(m(I(l+b%w,0))),c=v(b/w);k.push(m(I(c,0))),i=E(n,g,r==o),n=0,++r}++n,++e}return k.join("")}if(s={version:"1.4.1",ucs2:{decode:S,encode:b},decode:k,encode:O,toASCII:function(t){return w(t,(function(t){return l.test(t)?"xn--"+O(t):t}))},toUnicode:function(t){return w(t,(function(t){return p.test(t)?k(t.slice(4).toLowerCase()):t}))}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",(function(){return s}));else if(o&&i)if(e.exports==o)i.exports=s;else for(c in s)s.hasOwnProperty(c)&&(o[c]=s[c]);else r.punycode=s}(this)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(t,e,n){"use strict";function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.exports=function(t,e,n,i){e=e||"&",n=n||"=";var a={};if("string"!=typeof t||0===t.length)return a;var s=/\+/g;t=t.split(e);var c=1e3;i&&"number"==typeof i.maxKeys&&(c=i.maxKeys);var u=t.length;c>0&&u>c&&(u=c);for(var h=0;h<u;++h){var p,l,f,d,v=t[h].replace(s,"%20"),m=v.indexOf(n);m>=0?(p=v.substr(0,m),l=v.substr(m+1)):(p=v,l=""),f=decodeURIComponent(p),d=decodeURIComponent(l),r(a,f)?o(a[f])?a[f].push(d):a[f]=[a[f],d]:a[f]=d}return a};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],8:[function(t,e,n){"use strict";var r=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(t,e,n,s){return e=e||"&",n=n||"=",null===t&&(t=void 0),"object"==typeof t?i(a(t),(function(a){var s=encodeURIComponent(r(a))+n;return o(t[a])?i(t[a],(function(t){return s+encodeURIComponent(r(t))})).join(e):s+encodeURIComponent(r(t[a]))})).join(e):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(t)):""};var o=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function i(t,e){if(t.map)return t.map(e);for(var n=[],r=0;r<t.length;r++)n.push(e(t[r],r));return n}var a=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},{}],9:[function(t,e,n){"use strict";n.decode=n.parse=t("./decode"),n.encode=n.stringify=t("./encode")},{"./decode":7,"./encode":8}],10:[function(t,e,n){"use strict";var r=t("punycode"),o=t("./util");function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}n.parse=w,n.resolve=function(t,e){return w(t,!1,!0).resolve(e)},n.resolveObject=function(t,e){return t?w(t,!1,!0).resolveObject(e):e},n.format=function(t){o.isString(t)&&(t=w(t));return t instanceof i?t.format():i.prototype.format.call(t)},n.Url=i;var a=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),h=["'"].concat(u),p=["%","/","?",";","#"].concat(h),l=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=t("querystring");function w(t,e,n){if(t&&o.isObject(t)&&t instanceof i)return t;var r=new i;return r.parse(t,e,n),r}i.prototype.parse=function(t,e,n){if(!o.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var i=t.indexOf("?"),s=-1!==i&&i<t.indexOf("#")?"?":"#",u=t.split(s);u[0]=u[0].replace(/\\/g,"/");var w=t=u.join(s);if(w=w.trim(),!n&&1===t.split("#").length){var S=c.exec(w);if(S)return this.path=w,this.href=w,this.pathname=S[1],S[2]?(this.search=S[2],this.query=e?g.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var b=a.exec(w);if(b){var I=(b=b[0]).toLowerCase();this.protocol=I,w=w.substr(b.length)}if(n||b||w.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===w.substr(0,2);!E||b&&m[b]||(w=w.substr(2),this.slashes=!0)}if(!m[b]&&(E||b&&!y[b])){for(var k,O,_=-1,x=0;x<l.length;x++){-1!==(N=w.indexOf(l[x]))&&(-1===_||N<_)&&(_=N)}-1!==(O=-1===_?w.lastIndexOf("@"):w.lastIndexOf("@",_))&&(k=w.slice(0,O),w=w.slice(O+1),this.auth=decodeURIComponent(k)),_=-1;for(x=0;x<p.length;x++){var N;-1!==(N=w.indexOf(p[x]))&&(-1===_||N<_)&&(_=N)}-1===_&&(_=w.length),this.host=w.slice(0,_),w=w.slice(_),this.parseHost(),this.hostname=this.hostname||"";var R="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!R)for(var C=this.hostname.split(/\./),j=(x=0,C.length);x<j;x++){var L=C[x];if(L&&!L.match(f)){for(var A="",T=0,P=L.length;T<P;T++)L.charCodeAt(T)>127?A+="x":A+=L[T];if(!A.match(f)){var q=C.slice(0,x),M=C.slice(x+1),B=L.match(d);B&&(q.push(B[1]),M.unshift(B[2])),M.length&&(w="/"+M.join(".")+w),this.hostname=q.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),R||(this.hostname=r.toASCII(this.hostname));var D=this.port?":"+this.port:"",U=this.hostname||"";this.host=U+D,this.href+=this.host,R&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==w[0]&&(w="/"+w))}if(!v[I])for(x=0,j=h.length;x<j;x++){var F=h[x];if(-1!==w.indexOf(F)){var z=encodeURIComponent(F);z===F&&(z=escape(F)),w=w.split(F).join(z)}}var H=w.indexOf("#");-1!==H&&(this.hash=w.substr(H),w=w.slice(0,H));var K=w.indexOf("?");if(-1!==K?(this.search=w.substr(K),this.query=w.substr(K+1),e&&(this.query=g.parse(this.query)),w=w.slice(0,K)):e&&(this.search="",this.query={}),w&&(this.pathname=w),y[I]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){D=this.pathname||"";var V=this.search||"";this.path=D+V}return this.href=this.format(),this},i.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,a="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&o.isObject(this.query)&&Object.keys(this.query).length&&(a=g.stringify(this.query));var s=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||y[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),e+i+(n=n.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(s=s.replace("#","%23"))+r},i.prototype.resolve=function(t){return this.resolveObject(w(t,!1,!0)).format()},i.prototype.resolveObject=function(t){if(o.isString(t)){var e=new i;e.parse(t,!1,!0),t=e}for(var n=new i,r=Object.keys(this),a=0;a<r.length;a++){var s=r[a];n[s]=this[s]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var c=Object.keys(t),u=0;u<c.length;u++){var h=c[u];"protocol"!==h&&(n[h]=t[h])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!y[t.protocol]){for(var p=Object.keys(t),l=0;l<p.length;l++){var f=p[l];n[f]=t[f]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||m[t.protocol])n.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var v=n.pathname||"",g=n.search||"";n.path=v+g}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var w=n.pathname&&"/"===n.pathname.charAt(0),S=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=S||w||n.host&&t.pathname,I=b,E=n.pathname&&n.pathname.split("/")||[],k=(d=t.pathname&&t.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(k&&(n.hostname="",n.port=null,n.host&&(""===E[0]?E[0]=n.host:E.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),b=b&&(""===d[0]||""===E[0])),S)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,E=d;else if(d.length)E||(E=[]),E.pop(),E=E.concat(d),n.search=t.search,n.query=t.query;else if(!o.isNullOrUndefined(t.search)){if(k)n.hostname=n.host=E.shift(),(R=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=R.shift(),n.host=n.hostname=R.shift());return n.search=t.search,n.query=t.query,o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!E.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var O=E.slice(-1)[0],_=(n.host||t.host||E.length>1)&&("."===O||".."===O)||""===O,x=0,N=E.length;N>=0;N--)"."===(O=E[N])?E.splice(N,1):".."===O?(E.splice(N,1),x++):x&&(E.splice(N,1),x--);if(!b&&!I)for(;x--;x)E.unshift("..");!b||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),_&&"/"!==E.join("/").substr(-1)&&E.push("");var R,C=""===E[0]||E[0]&&"/"===E[0].charAt(0);k&&(n.hostname=n.host=C?"":E.length?E.shift():"",(R=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=R.shift(),n.host=n.hostname=R.shift()));return(b=b||n.host&&E.length)&&!C&&E.unshift(""),E.length?n.pathname=E.join("/"):(n.pathname=null,n.path=null),o.isNull(n.pathname)&&o.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var t=this.host,e=s.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":11,punycode:6,querystring:9}],11:[function(t,e,n){"use strict";e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],12:[function(t,e,n){"use strict";e.exports=t("./wrapFetch")},{"./wrapFetch":13}],13:[function(t,e,n){"use strict";var r=t("zipkin").Instrumentation;e.exports=function(t,e){var n=e.tracer,o=e.serviceName,i=e.remoteServiceName,a=new r.HttpClient({tracer:n,serviceName:o,remoteServiceName:i});return function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(o,i){n.scoped((function(){var s="string"==typeof e?e:e.url,c=r.method||"GET",u=a.recordRequest(r,s,c),h=n.id;t(s,u).then((function(t){n.scoped((function(){a.recordResponse(h,t.status)})),o(t)})).catch((function(t){n.scoped((function(){a.recordError(h,t)})),i(t)}))}))}))}}},{zipkin:16}],14:[function(t,e,n){(function(n){(function(){"use strict";function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},i(t,e,n||t)}function a(t,e){return a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},a(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=u(t);if(e){var o=u(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function c(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}var h="undefined"!=typeof window&&window.fetch||void 0!==n&&n.fetch||t("node-fetch"),p=t("zipkin").jsonEncoder.JSON_V1,l=t("events").EventEmitter,f=h,d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(h,t);var e,n,r,c=s(h);function h(t){var e,n=t.endpoint,r=t.headers,o=void 0===r?{}:r,i=t.agent,a=void 0===i?null:i,s=t.httpInterval,u=void 0===s?1e3:s,l=t.jsonEncoder,d=void 0===l?p:l,v=t.timeout,m=void 0===v?0:v,y=t.maxPayloadSize,g=void 0===y?0:y,w=t.log,S=void 0===w?console:w,b=t.fetchImplementation,I=void 0===b?f:b;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=c.call(this)).log=S,e.endpoint=n,e.agent=a,e.maxPayloadSize=g,e.queue=[],e.queueBytes=0,e.jsonEncoder=d,e.fetchImplementation=I,e.errorListenerSet=!1,e.headers=Object.assign({"Content-Type":"application/json"},o),e.timeout=m;var E=setInterval((function(){e.processQueue(e.fetchImplementation)}),u);return E.unref&&E.unref(),e}return e=h,n=[{key:"_getPayloadSize",value:function(t){return t?this.queueBytes+2+this.queue.length+t.length:this.queueBytes+2+Math.min(this.queue.length-1,0)}},{key:"on",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0];"error"===r.toLowerCase()&&(this.errorListenerSet=!0),i(u(h.prototype),"on",this).apply(this,e)}},{key:"logSpan",value:function(t){var e=this.jsonEncoder.encode(t);if(this.maxPayloadSize&&this._getPayloadSize(e)>this.maxPayloadSize&&(this.processQueue(this.fetchImplementation),this._getPayloadSize(e)>this.maxPayloadSize)){var n="Zipkin span got dropped, reason: payload too large";this.errorListenerSet?this.emit("error",new Error(n)):this.log.error(n)}else this.queue.push(e),this.queueBytes+=e.length}},{key:"processQueue",value:function(t){var e=this,n=this;if(n.queue.length>0){var r="[".concat(n.queue.join(","),"]"),o={method:"POST",body:r,headers:n.headers,timeout:n.timeout,agent:n.agent};t(n.endpoint,o).then((function(t){if(202!==t.status&&200!==t.status){var o="Unexpected response while sending Zipkin data, status:"+"".concat(t.status,", body: ").concat(r);n.errorListenerSet?e.emit("error",new Error(o)):e.log.error(o)}else e.emit("success",t)})).catch((function(t){var r="Error sending Zipkin data ".concat(t);n.errorListenerSet?e.emit("error",new Error(r)):e.log.error(r)})),n.queue.length=0,n.queueBytes=0}}}],n&&o(e.prototype,n),r&&o(e,r),h}(l);e.exports=d}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:2,"node-fetch":3,zipkin:16}],15:[function(t,e,n){"use strict";e.exports.HttpLogger=t("./HttpLogger")},{"./HttpLogger":14}],16:[function(t,e,n){(function(e){(function(){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(n,"__esModule",{value:!0});var o=r(t("os")),i=r(t("url"));function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}function f(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function d(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=p(t);if(e){var o=p(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return f(this,n)}}var v={get type(){return"None"},get present(){return!1},map:function(){return this},ifPresent:function(){},flatMap:function(){return this},getOrElse:function(t){return t instanceof Function?t():t},equals:function(t){return t===this},toString:function(){return"None"}},m=function(){function t(e){s(this,t),this.value=e}return u(t,[{key:"map",value:function(e){return new t(e(this.value))}},{key:"ifPresent",value:function(t){t(this.value)}},{key:"flatMap",value:function(t){return t(this.value)}},{key:"getOrElse",value:function(){return this.value}},{key:"equals",value:function(e){return e instanceof t&&e.value===this.value}},{key:"toString",value:function(){return"Some(".concat(this.value,")")}},{key:"type",get:function(){return"Some"}},{key:"present",get:function(){return!0}}]),t}();function y(t){return t instanceof m||v.equals(t)}var g={Some:m,None:v,isOptional:y,verifyIsOptional:function(t){if(null==t)throw new Error("Error: data is not Optional - it's null");if(!y(t))throw new Error("Error: data (".concat(t,") is not an Option!"));if(y(t.value))throw new Error("Error: data (".concat(t.value,") is wrapped in Option twice"))},verifyIsNotOptional:function(t){if(y(t))throw new Error("Error: data (".concat(t,") is an Option!"))},fromNullable:function(t){return null==t?v:new m(t)}};function w(t,e){for(var n in t)for(var r=t[n].length-1;r>=0;r-=1){var o=t[n][r],i="IPv4"===e||0===o.scopeid;if(!o.internal&&o.family===e&&i)return o.address}return"IPv4"===e?"127.0.0.1":"::1"}function S(t,e){var n={};for(var r in t)r===e&&(n[r]=t[r]);return n}function b(t){var e=o.networkInterfaces();return t&&(e=S(e,t)),w(e,"IPv4")}b.ipv4=b,b.ipv6=function(t){var e=o.networkInterfaces();return t&&(e=S(e,t)),w(e,"IPv6")};var I=b,E=function(){function t(e){s(this,t),this.addr=e}return u(t,[{key:"ipv4",value:function(){var t=this.toInt();if(t&&0!==t)return this.addr}},{key:"toInt",value:function(){var t=this.addr.split(".");return t[0]<<24|t[1]<<16|t[2]<<8|t[3]}},{key:"toString",value:function(){return"InetAddress(".concat(this.addr,")")}}]),t}();var k="object"===(void 0===e?"undefined":a(e))&&"function"==typeof e.on?new E(I.ipv4()):new E("127.0.0.1");E.getLocalAddress=function(){return k};var O=E,_=function(){function t(){s(this,t)}return u(t,[{key:"toString",value:function(){return"".concat(this.annotationType,"()")}}]),t}(),x=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_),N=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_),R=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_),C=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_),j=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_),L=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_),A=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_),T=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_);function P(t){this.name=t}P.prototype.toString=function(){return'LocalOperationStart("'.concat(this.name,'")')};var q=function(t){h(n,t);var e=d(n);function n(){return s(this,n),e.apply(this,arguments)}return n}(_);function M(t){this.message=t}function B(t){this.serviceName=t}function D(t){this.name=t}function U(t){var e=t.host,n=t.port;this.host=e,this.port=n}function F(t){var e=t.serviceName,n=t.host,r=t.port;this.serviceName=e,this.host=n||void 0,this.port=r||0}function z(t){var e=t.host,n=t.port;this.host=e||O.getLocalAddress(),this.port=n||0}function H(t){var e=t.serviceName,n=t.host,r=t.port;this.serviceName=e,this.host=n,this.port=r}function K(t,e){this.key=t,this.value=e}M.prototype.toString=function(){return'Message("'.concat(this.message,'")')},B.prototype.toString=function(){return'ServiceName("'.concat(this.serviceName,'")')},D.prototype.toString=function(){return'Rpc("'.concat(this.name,'")')},U.prototype.toString=function(){return'ClientAddr(host="'.concat(this.host,'", port=').concat(this.port,")")},F.prototype.toString=function(){return'ServerAddr(serviceName="'.concat(this.serviceName,'", host="').concat(this.host,'", port=').concat(this.port,")")},z.prototype.toString=function(){return'LocalAddr(host="'.concat(this.host.toString(),'", port=').concat(this.port,")")},H.prototype.toString=function(){return'MessageAddr(serviceName="'.concat(this.serviceName,'", host="').concat(this.host,'", port=').concat(this.port,")")},K.prototype.toString=function(){return"BinaryAnnotation(".concat(this.key,'="').concat(this.value,'")')};var V={ClientSend:x,ClientRecv:N,ServerSend:R,ServerRecv:C,ProducerStart:j,ProducerStop:L,ConsumerStart:A,ConsumerStop:T,MessageAddr:H,Message:M,ServiceName:B,Rpc:D,ClientAddr:U,ServerAddr:F,LocalAddr:z,BinaryAnnotation:K,LocalOperationStart:P,LocalOperationStop:q};Object.keys(V).forEach((function(t){V[t].prototype.annotationType=t}));var J=V,X=$,Z=$;function $(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}X.default=Z;var Q=g.Some,G=function(){function t(e){s(this,t),this.evaluator=e}return u(t,[{key:"shouldSample",value:function(t){var e=this,n=t.sampled.getOrElse((function(){return e.evaluator(t)}));return new Q(n)}},{key:"toString",value:function(){return"Sampler(".concat(this.evaluator.toString(),")")}}]),t}();function W(t){return!1}function Y(t){return!0}function tt(t){if(t<=0)return W;if(t>=1)return Y;var e=0,n=parseInt(1/t),r=function(t){var r=0===(e%=n);return e+=1,r};return r.toString=function(){return"countingSampler: sampleRate=".concat(t)},r}W.toString=function(){return"never sample"},Y.toString=function(){return"always sample"};var et=function(t){h(n,t);var e=d(n);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return s(this,n),e.call(this,tt(t<1?t:1))}return n}(G),nt={Sampler:G,CountingSampler:et,neverSample:W,alwaysSample:Y},rt=function(){function t(e){var n=e.traceId,r=e.timestamp,o=e.annotation;s(this,t),this.traceId=n,this.timestamp=r,this.annotation=o}return u(t,[{key:"toString",value:function(){return"Record(traceId=".concat(this.traceId.toString(),", annotation=").concat(this.annotation.toString(),")")}}]),t}(),ot=rt,it=g.None,at=g.verifyIsOptional,st=g.verifyIsNotOptional,ct=g.isOptional,ut=new(0,g.Some)(!0),ht=function(){function t(e){s(this,t);var n=e.spanId,r=e.traceId,o=void 0===r?n:r,i=e.parentId,a=void 0===i?it:i,c=e.flags,u=void 0===c?0:c,h=e.debug,p=void 0===h?1===u:h,l=e.sampled,f=void 0===l?it:l,d=e.shared,v=void 0!==d&&d;st(n),at(a),at(f),ct(o)?this._traceId=o.getOrElse(n):this._traceId=null==o?n:o,this._parentId=a,this._spanId=n,this._sampled=p?ut:f,this._debug=p,this._shared=v}return u(t,[{key:"isDebug",value:function(){return this._debug}},{key:"isShared",value:function(){return this._shared}},{key:"toString",value:function(){return"TraceId(spanId=".concat(this.spanId.toString())+", parentSpanId=".concat(this.parentSpanId.toString())+", traceId=".concat(this.traceId.toString(),")")}},{key:"traceId",get:function(){return this._traceId}},{key:"parentSpanId",get:function(){return this._parentId}},{key:"parentId",get:function(){return this._parentId.getOrElse(this._spanId)}},{key:"spanId",get:function(){return this._spanId}},{key:"sampled",get:function(){return this._sampled}},{key:"flags",get:function(){return this._debug?1:0}}]),t}();var pt=function(){for(var t="",e=0;e<16;e+=1){t+="0123456789abcdef"[Math.floor(16*Math.random())]}return t},lt=void 0!==e&&e.hrtime;var ft={now:lt?function(t,n){if(t&&n){var r=e.hrtime(n);return t+Math.floor(1e6*r[0]+r[1]/1e3)}return 1e3*Date.now()}:function(){return 1e3*Date.now()},hrtime:lt?function(){return e.hrtime()}:function(){}};function dt(t){var e=t.serviceName,n=t.ipv4,r=t.port;this.setServiceName(e),this.setIpv4(n),this.setPort(r)}function vt(t,e){this.timestamp=t,this.value=e.toString()}function mt(t){var e=this;this.traceId=t.traceId,t.parentSpanId.ifPresent((function(t){e.parentId=t})),this.id=t.spanId,this.name=void 0,this.kind=void 0,this.timestamp=void 0,this.duration=void 0,this.localEndpoint=void 0,this.remoteEndpoint=void 0,this.annotations=[],this.tags={},this.debug=t.isDebug(),this.shared=t.isShared()}dt.prototype.setServiceName=function(t){this.serviceName=t?t.toLocaleLowerCase():void 0},dt.prototype.setIpv4=function(t){this.ipv4=t},dt.prototype.setPort=function(t){this.port=t||void 0},dt.prototype.isEmpty=function(){return void 0===this.serviceName&&void 0===this.ipv4&&void 0===this.port},vt.prototype.toString=function(){return'Annotation(value="'.concat(this.value,'")')},mt.prototype.setName=function(t){this.name=t?t.toLocaleLowerCase():void 0},mt.prototype.setKind=function(t){this.kind=t},mt.prototype.setTimestamp=function(t){this.timestamp=t},mt.prototype.setDuration=function(t){void 0!==t&&(this.duration=Math.max(t,1))},mt.prototype.setLocalEndpoint=function(t){t&&!t.isEmpty()?this.localEndpoint=t:this.localEndpoint=void 0},mt.prototype.setRemoteEndpoint=function(t){t&&!t.isEmpty()?this.remoteEndpoint=t:this.remoteEndpoint=void 0},mt.prototype.addAnnotation=function(t,e){this.annotations.push(new vt(t,e))},mt.prototype.putTag=function(t,e){this.tags[t]=e.toString()},mt.prototype.setDebug=function(t){this.debug=t},mt.prototype.setShared=function(t){this.shared=t},mt.prototype.toString=function(){var t=this.annotations.map((function(t){return t.toString()})).join(", ");return"Span(id=".concat(this.traceId,", annotations=[").concat(t,"])")};var yt={Endpoint:dt,Span:mt},gt=g.None,wt=g.Some,St=nt.Sampler,bt=nt.alwaysSample,It=ft.now,Et=ft.hrtime,kt=yt.Endpoint;function Ot(t){throw new Error("Tracer: Missing required argument ".concat(t,"."))}function _t(t){return null==t}var xt=function(){function t(e){var n=e.ctxImpl,r=void 0===n?Ot("ctxImpl"):n,o=e.recorder,i=void 0===o?Ot("recorder"):o,a=e.sampler,c=void 0===a?new St(bt):a,u=e.traceId128Bit,h=void 0!==u&&u,p=e.supportsJoin,l=void 0===p||p,f=e.localServiceName,d=e.localEndpoint,v=e.log,m=void 0===v?console:v,y=e.defaultTags;s(this,t),this.log=m,this.recorder=i,this.sampler=c,this.traceId128Bit=h,this.supportsJoin=l,this._localEndpoint=d||new kt({serviceName:f||"unknown"}),this._ctxImpl=r,this._sentinelTraceId=this.createRootId(),this._startTimestamp=It(),this._startTick=Et(),this.recorder.setDefaultTags&&this.recorder.setDefaultTags(y)}return u(t,[{key:"scoped",value:function(t){return this._ctxImpl.scoped(t)}},{key:"letId",value:function(t,e){return this._ctxImpl.letContext(t,e)}},{key:"createRootId",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gt,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=pt(),r=this.traceId128Bit?pt()+n:n,o=new ht({traceId:r,parentId:gt,spanId:n,sampled:t,flags:e?1:0});return t===gt&&(o._sampled=this.sampler.shouldSample(o)),o}},{key:"createChildId",value:function(t){if(_t(t)&&(t=this._ctxImpl.getContext()),t===this._sentinelTraceId||_t(t))return this.createRootId();var e=new ht({traceId:t.traceId,parentId:new wt(t.spanId),spanId:pt(),debug:t.isDebug(),sampled:t.sampled});return!1===e.sampled.present&&(e._sampled=this.sampler.shouldSample(e)),e}},{key:"_explicitRecord",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:It(this._startTimestamp,this._startTick);this.recorder.record(new ot({traceId:t,timestamp:n,annotation:e}))}},{key:"local",value:function(t,e){var n=this;if("function"!=typeof e)throw new Error("you must pass a function");return this.scoped((function(){var r,o=n.createChildId();n.setId(o),n.recordServiceName(n._localEndpoint.serviceName),n.recordAnnotation(new J.LocalOperationStart(t));try{r=e()}catch(t){throw n.recordBinary("error",t.message?t.message:t.toString()),n.recordAnnotation(new J.LocalOperationStop),t}return X(r)?o.sampled.getOrElse(!1)?r.then((function(t){return n._explicitRecord(o,new J.LocalOperationStop),t})).catch((function(t){var e=t.message?t.message:t.toString();throw n._explicitRecord(o,new J.BinaryAnnotation("error",e)),n._explicitRecord(o,new J.LocalOperationStop),t})):r:(n.recordAnnotation(new J.LocalOperationStop),r)}))}},{key:"join",value:function(t){if(_t(t))throw new Error("traceId is a required arg");if(_t(t._spanId))throw new Error("Must be valid TraceId instance");return this.supportsJoin?(t.sampled===gt?t._sampled=this.sampler.shouldSample(t):t._shared=!0,t):this.createChildId(t)}},{key:"setId",value:function(t){this._ctxImpl.setContext(t)}},{key:"recordAnnotation",value:function(t,e){this.id.sampled.getOrElse(!1)&&this._explicitRecord(this.id,t,e)}},{key:"recordMessage",value:function(t){this.recordAnnotation(new J.Message(t))}},{key:"recordServiceName",value:function(t){this.recordAnnotation(new J.ServiceName(t))}},{key:"recordRpc",value:function(t){this.recordAnnotation(new J.Rpc(t))}},{key:"recordClientAddr",value:function(t){this.recordAnnotation(new J.ClientAddr(t))}},{key:"recordServerAddr",value:function(t){this.recordAnnotation(new J.ServerAddr(t))}},{key:"recordLocalAddr",value:function(t){this.recordAnnotation(new J.LocalAddr(t))}},{key:"recordBinary",value:function(t,e){this.recordAnnotation(new J.BinaryAnnotation(t,e))}},{key:"writeIdToConsole",value:function(t){this.log.info("".concat(t,": ").concat(this.id.toString()))}},{key:"setTags",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&this.recordBinary(e,t[e])}},{key:"id",get:function(){return this._ctxImpl.getContext()||this._sentinelTraceId}},{key:"localEndpoint",get:function(){return this._localEndpoint}}]),t}(),Nt=xt,Rt=function(){function t(){s(this,t),this.currentCtx=null}return u(t,[{key:"setContext",value:function(t){this.currentCtx=t}},{key:"getContext",value:function(){return this.currentCtx}},{key:"scoped",value:function(t){var e=this.getContext();try{return t()}finally{this.setContext(e)}}},{key:"letContext",value:function(t,e){var n=this;return this.scoped((function(){return n.setContext(t),e()}))}}]),t}(),Ct={TraceId:"X-B3-TraceId",SpanId:"X-B3-SpanId",ParentSpanId:"X-B3-ParentSpanId",Sampled:"X-B3-Sampled",Flags:"X-B3-Flags"},jt=ft.now,Lt=yt.Span,At=yt.Endpoint,Tt=Symbol("defaultTags");var Pt=function(){function t(e,n){s(this,t),this.traceId=e,this.timeoutTimestamp=n,this.delegate=new Lt(e),this.localEndpoint=new At({}),this.shouldFlush=!1}return u(t,[{key:"setDuration",value:function(t){if(!this.shouldFlush){this.shouldFlush=!0;var e=this.delegate.timestamp;void 0===e?this.delegate.addAnnotation(t,"finish"):this.delegate.setDuration(t-e)}}}]),t}(),qt=function(){function t(e){var n=this,r=e.logger,o=e.timeout,i=void 0===o?6e7:o;s(this,t),this.logger=r,this.timeout=i,this.partialSpans=new Map,this[Tt]={};var a=setInterval((function(){n.partialSpans.forEach((function(t,e){(function(t){return t.timeoutTimestamp<jt()})(t)&&(t.delegate.addAnnotation(jt(),"zipkin-js.flush"),n._writeSpan(e,t))}))}),1e3);a.unref&&a.unref()}return u(t,[{key:"_addDefaultTagsAndLocalEndpoint",value:function(t){var e=this[Tt];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.delegate.putTag(n,e[n]);t.delegate.setLocalEndpoint(t.localEndpoint)}},{key:"_writeSpan",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n||void 0!==this.partialSpans.get(t)){this.partialSpans.delete(t);var r=e.delegate;e.delegate.timestamp&&this._addDefaultTagsAndLocalEndpoint(e),this.logger.logSpan(r)}}},{key:"_updateSpanMap",value:function(t,e,n){var r,o=!1;this.partialSpans.has(t)?r=this.partialSpans.get(t):(o=!0,r=new Pt(t,e+this.timeout)),n(r),r.shouldFlush?this._writeSpan(t,r,o):this.partialSpans.set(t,r)}},{key:"flush",value:function(){var t=this;this.partialSpans.forEach((function(e,n){t._writeSpan(n,e)}))}},{key:"record",value:function(t){var e=t.traceId;this._updateSpanMap(e,t.timestamp,(function(n){switch(t.annotation.annotationType){case"ClientAddr":n.delegate.setKind("SERVER"),n.delegate.setRemoteEndpoint(new At({serviceName:t.annotation.serviceName,ipv4:t.annotation.host&&t.annotation.host.ipv4(),port:t.annotation.port}));break;case"ClientSend":n.delegate.setKind("CLIENT"),n.delegate.setTimestamp(t.timestamp);break;case"ClientRecv":n.delegate.setKind("CLIENT"),n.setDuration(t.timestamp);break;case"ServerSend":n.delegate.setKind("SERVER"),n.setDuration(t.timestamp);break;case"ServerRecv":n.delegate.setShared(e.isShared()),n.delegate.setKind("SERVER"),n.delegate.setTimestamp(t.timestamp);break;case"ProducerStart":n.delegate.setKind("PRODUCER"),n.delegate.setTimestamp(t.timestamp);break;case"ProducerStop":n.delegate.setKind("PRODUCER"),n.setDuration(t.timestamp);break;case"ConsumerStart":n.delegate.setKind("CONSUMER"),n.delegate.setTimestamp(t.timestamp);break;case"ConsumerStop":n.delegate.setKind("CONSUMER"),n.setDuration(t.timestamp);break;case"MessageAddr":n.delegate.setRemoteEndpoint(new At({serviceName:t.annotation.serviceName,ipv4:t.annotation.host&&t.annotation.host.ipv4(),port:t.annotation.port}));break;case"LocalOperationStart":n.delegate.setName(t.annotation.name),n.delegate.setTimestamp(t.timestamp);break;case"LocalOperationStop":n.setDuration(t.timestamp);break;case"Message":n.delegate.addAnnotation(t.timestamp,t.annotation.message);break;case"Rpc":n.delegate.setName(t.annotation.name);break;case"ServiceName":n.localEndpoint.setServiceName(t.annotation.serviceName);break;case"BinaryAnnotation":n.delegate.putTag(t.annotation.key,t.annotation.value);break;case"LocalAddr":n.localEndpoint.setIpv4(t.annotation.host&&t.annotation.host.ipv4()),n.localEndpoint.setPort(t.annotation.port);break;case"ServerAddr":n.delegate.setKind("CLIENT"),n.delegate.setRemoteEndpoint(new At({serviceName:t.annotation.serviceName,ipv4:t.annotation.host&&t.annotation.host.ipv4(),port:t.annotation.port}))}}))}},{key:"setDefaultTags",value:function(t){this[Tt]=t}},{key:"toString",value:function(){return"BatchRecorder()"}}]),t}(),Mt=qt,Bt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:console.log;s(this,t),this.logger=e}return u(t,[{key:"record",value:function(t){var e=t.traceId,n=e.spanId,r=e.parentId,o=e.traceId;this.logger("Record at (timestamp=".concat(t.timestamp,", spanId=").concat(n,", parentId=").concat(r,", ")+"traceId=".concat(o,"): ").concat(t.annotation.toString()))}},{key:"toString",value:function(){return"consoleTracer"}}]),t}(),Dt=Bt;var Ut=function(t){var e=i.parse(t);return{host:e.hostname,path:e.pathname}},Ft=g.Some,zt=g.None;function Ht(t){return"1"===t||"true"===t}function Kt(t){try{return new Ft(parseInt(t))}catch(t){return zt}}function Vt(t){throw new Error("HttpServerInstrumentation: Missing required argument ".concat(t,"."))}var Jt=function(){function t(e){var n=e.tracer,r=void 0===n?Vt("tracer"):n,o=e.serviceName,i=void 0===o?r.localEndpoint.serviceName:o,a=e.host,c=e.port,u=void 0===c?Vt("port"):c;s(this,t),this.tracer=r,this.serviceName=i,this.host=a&&new O(a),this.port=u}return u(t,[{key:"_createIdFromHeaders",value:function(t){if(function(t){return t(Ct.TraceId)!==zt&&t(Ct.SpanId)!==zt}(t)){var e=t(Ct.SpanId).map((function(e){var n=t(Ct.TraceId),r=t(Ct.ParentSpanId),o=t(Ct.Sampled),i=t(Ct.Flags).flatMap(Kt).getOrElse(0);return new ht({traceId:n.getOrElse(),parentId:r,spanId:e,debug:1===i,sampled:o.map(Ht)})}));return new Ft(this.tracer.join(e.getOrElse()))}if(t(Ct.Flags)!==zt||t(Ct.Sampled)!==zt){var n=t(Ct.Sampled)===zt?zt:t(Ct.Sampled).map(Ht),r=t(Ct.Flags).flatMap(Kt).getOrElse(0);return new Ft(this.tracer.createRootId(n,1===r))}return new Ft(this.tracer.createRootId())}},{key:"spanNameFromRoute",value:function(t,e,n){return n>299&&n<400?"".concat(t," redirected"):404===n?"".concat(t," not_found"):e&&""!==e?"".concat(t," ").concat(e):t}},{key:"recordRequest",value:function(t,e,n){var r=this;this._createIdFromHeaders(n).ifPresent((function(t){return r.tracer.setId(t)}));var o=this.tracer.id,i=Ut(e).path;return this.tracer.recordServiceName(this.serviceName),this.tracer.recordRpc(t.toUpperCase()),this.tracer.recordBinary("http.path",i),this.tracer.recordAnnotation(new J.ServerRecv),this.tracer.recordAnnotation(new J.LocalAddr({host:this.host,port:this.port})),o}},{key:"recordResponse",value:function(t,e,n){this.tracer.setId(t),this.tracer.recordBinary("http.status_code",e.toString()),n?this.tracer.recordBinary("error",n.toString()):(e<200||e>399)&&this.tracer.recordBinary("error",e.toString()),this.tracer.recordAnnotation(new J.ServerSend)}}]),t}(),Xt=Jt;var Zt={addZipkinHeaders:function(t,e){var n=function(t,e){var n=t.headers||{};return n[Ct.TraceId]=e.traceId,n[Ct.SpanId]=e.spanId,e.parentSpanId.ifPresent((function(t){n[Ct.ParentSpanId]=t})),e.sampled.ifPresent((function(t){n[Ct.Sampled]=t?"1":"0"})),e.isDebug()&&(n[Ct.Flags]="1"),n}(t,e);return Object.assign({},t,{headers:n})}};var $t=function(){function t(e){var n=e.tracer,r=void 0===n?function(t){throw new Error("HttpClientInstrumentation: Missing required argument ".concat(t,"."))}("tracer"):n,o=e.serviceName,i=void 0===o?r.localEndpoint.serviceName:o,a=e.remoteServiceName;s(this,t),this.tracer=r,this.serviceName=i,this.remoteServiceName=a}return u(t,[{key:"recordRequest",value:function(t,e,n){this.tracer.setId(this.tracer.createChildId());var r=this.tracer.id,o=Ut(e).path;return this.tracer.recordServiceName(this.serviceName),this.tracer.recordRpc(n.toUpperCase()),this.tracer.recordBinary("http.path",o),this.tracer.recordAnnotation(new J.ClientSend),this.remoteServiceName&&this.tracer.recordAnnotation(new J.ServerAddr({serviceName:this.remoteServiceName})),Zt.addZipkinHeaders(t,r)}},{key:"recordResponse",value:function(t,e){this.tracer.setId(t),this.tracer.recordBinary("http.status_code",e.toString()),(e<200||e>399)&&this.tracer.recordBinary("error",e.toString()),this.tracer.recordAnnotation(new J.ClientRecv)}},{key:"recordError",value:function(t,e){this.tracer.setId(t),this.tracer.recordBinary("error",e.toString()),this.tracer.recordAnnotation(new J.ClientRecv)}}]),t}(),Qt={HttpServer:Xt,HttpClient:$t};function Gt(t){if(void 0!==t){var e={serviceName:t.serviceName||""};return t.ipv4&&(e.ipv4=t.ipv4),t.port&&(e.port=t.port),e}}var Wt={JSON_V1:{encode:function(t){return function(t){var e={traceId:t.traceId};t.parentId&&(e.parentId=t.parentId),e.id=t.id,e.name=t.name||"",t.shared||(e.timestamp=t.timestamp,e.duration=t.duration);var n,r,o,i=Gt(t.localEndpoint);switch(t.kind){case"CLIENT":n=t.timestamp?"cs":void 0,r="cr",o="sa";break;case"SERVER":n=t.timestamp?"sr":void 0,r="ss",o="ca";break;case"PRODUCER":n=t.timestamp?"ms":void 0,r="ws",o="ma";break;case"CONSUMER":t.timestamp&&t.duration?(n="wr",r="mr"):t.timestamp&&(n="mr"),o="ma"}(t.annotations.length>0||n)&&(e.annotations=t.annotations.map((function(t){return function(t,e){return{value:t.value,timestamp:t.timestamp,endpoint:e}}(t,i)}))),n&&(e.annotations.push({value:n,timestamp:t.timestamp,endpoint:i}),t.duration&&e.annotations.push({value:r,timestamp:t.timestamp+t.duration,endpoint:i}));var a=Object.keys(t.tags);if((a.length>0||t.remoteEndpoint)&&(e.binaryAnnotations=a.map((function(e){return{key:e,value:t.tags[e],endpoint:i}}))),t.remoteEndpoint){var s={key:o,value:!0,endpoint:Gt(t.remoteEndpoint)};e.binaryAnnotations.push(s)}return t.debug&&(e.debug=!0),JSON.stringify(e)}(t)}},JSON_V2:{encode:function(t){return function(t){var e={traceId:t.traceId};return t.parentId&&(e.parentId=t.parentId),e.id=t.id,t.name&&(e.name=t.name),t.kind&&(e.kind=t.kind),t.timestamp&&(e.timestamp=t.timestamp),t.duration&&(e.duration=t.duration),t.localEndpoint&&(e.localEndpoint=t.localEndpoint),t.remoteEndpoint&&(e.remoteEndpoint=t.remoteEndpoint),t.annotations.length>0&&(e.annotations=t.annotations),Object.keys(t.tags).length>0&&(e.tags=t.tags),t.debug&&(e.debug=!0),t.shared&&(e.shared=!0),JSON.stringify(e)}(t)}}};n.option=g,n.Annotation=J,n.Tracer=Nt,n.createNoopTracer=function(){var t=new Rt;return new Nt({recorder:{record:function(){}},ctxImpl:t})},n.randomTraceId=pt,n.sampler=nt,n.TraceId=ht,n.HttpHeaders=Ct,n.InetAddress=O,n.BatchRecorder=Mt,n.ConsoleRecorder=Dt,n.ExplicitContext=Rt,n.Instrumentation=Qt,n.Request=Zt,n.jsonEncoder=Wt,n.model=yt,n.parseRequestUrl=Ut}).call(this)}).call(this,t("_process"))},{_process:5,os:4,url:10}],17:[function(t,e,n){(function(e){(function(){e.hrtime=t("browser-process-hrtime");const{Tracer:n,ExplicitContext:r,BatchRecorder:o,jsonEncoder:{JSON_V2:i}}=t("zipkin"),{HttpLogger:a}=t("zipkin-transport-http"),s=t("zipkin-instrumentation-fetch");function c(t,e){const c=function(t,e){const s=new r,c=new a({endpoint:`${t}/api/v2/spans`,jsonEncoder:i}),u=new o({logger:c});return new n({ctxImpl:s,recorder:u,localServiceName:e})}(t,e);return s(fetch,{tracer:c})}window.createTracedFetch=c,window.setupTracedFetch=function(t,e){window.tracedFetch=c(t,e)}}).call(this)}).call(this,t("_process"))},{_process:5,"browser-process-hrtime":1,zipkin:16,"zipkin-instrumentation-fetch":12,"zipkin-transport-http":15}]},{},[17]);
